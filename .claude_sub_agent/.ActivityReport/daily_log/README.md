# 📚 階層型エージェントシステム - 作業日誌管理ガイドライン

## 🎯 概要

作業日誌システムは、階層型エージェントシステムの全活動を詳細に記録し、プロジェクトの透明性と追跡可能性を確保するための仕組みです。

## 📂 ディレクトリ構造

```
.claude_sub_agent/.ActivityReport/daily_log/
├── README.md                    # このファイル
├── TEMPLATE_workingLog.md       # 日誌テンプレート
├── YYYY-MM-DD_workingLog.md    # 日次作業日誌
├── cleanup_old_logs.py          # Python版自動削除スクリプト
├── cleanup_old_logs.sh          # Bash版自動削除スクリプト
└── cleanup_report_*.md          # クリーンアップレポート
```

## 📝 日誌作成ルール

### 1. ファイル命名規則
- **形式**: `YYYY-MM-DD_workingLog.md`
- **例**: `2025-08-17_workingLog.md`
- **タイムゾーン**: システムローカル時間

### 2. 作成タイミング
- **自動生成**: 毎日18:00にCTOが自動集約
- **手動生成**: 重要なイベント発生時
- **リアルタイム更新**: 作業進行中に随時追記

### 3. 記録対象

#### 必須記録項目
- ✅ 各部門の思考プロセス
- ✅ 実行したコマンドと結果
- ✅ 部門間の指示・報告
- ✅ 意思決定とその根拠
- ✅ 発生した問題と解決策
- ✅ 成果物とその品質指標

#### 推奨記録項目
- 💡 改善提案
- 📊 パフォーマンスメトリクス
- 🎯 明日への申し送り事項
- 🏆 特筆すべき成功事例

## 🤖 各部門の記録責任

### 🎯 CTO
**記録範囲**: プロジェクト全体の統括活動
```markdown
- 戦略的意思決定
- 部門への指示内容
- 進捗状況の評価
- リスク管理
- ステークホルダー対応
```

### 💡 経営企画部
**記録範囲**: 戦略立案と要件管理
```markdown
- 市場分析結果
- 要件定義の変更
- 優先順位の決定
- 新技術の調査結果
- ROI分析
```

### 💻 システム開発部
**記録範囲**: 技術的実装活動
```markdown
- 設計決定とその理由
- 実装上の課題と解決
- コード変更の概要
- パフォーマンス改善
- 技術的負債の管理
```

### 🏢 人事部
**記録範囲**: チーム管理とリソース配分
```markdown
- チーム編成の変更
- スキル評価結果
- 生産性分析
- 研修・教育計画
- モチベーション管理
```

### 🛡️ 品質保証部
**記録範囲**: 品質管理とテスト活動
```markdown
- テスト実行結果
- バグ検出と分類
- コードレビュー結果
- 品質メトリクス
- 改善提案
```

## 🔄 日誌のライフサイクル

### 作成フェーズ
1. **09:00**: 朝礼記録から開始
2. **随時**: リアルタイムで活動を追記
3. **18:00**: CTOによる日次集約

### 保存フェーズ
- **保存期間**: 30日間
- **アーカイブ**: 重要な日誌は別途保存
- **バックアップ**: 週次で外部ストレージへ

### 削除フェーズ
- **自動削除**: 30日経過後
- **手動削除**: 機密情報を含む場合は即時
- **削除レポート**: 削除実行時に自動生成

## 🛠️ 自動削除スクリプトの使用方法

### Python版
```bash
# 基本使用（30日以上経過したログを削除）
python cleanup_old_logs.py

# ドライラン（削除対象の確認のみ）
python cleanup_old_logs.py --dry-run

# 保持期間を指定（60日）
python cleanup_old_logs.py --days 60

# ヘルプ表示
python cleanup_old_logs.py --help
```

### Bash版
```bash
# 基本使用（30日以上経過したログを削除）
./cleanup_old_logs.sh

# ドライラン（削除対象の確認のみ）
./cleanup_old_logs.sh --dry-run

# 保持期間を指定（7日）
./cleanup_old_logs.sh --days 7

# 特定ディレクトリを対象
./cleanup_old_logs.sh --path /path/to/logs
```

### 自動実行設定（cron）
```bash
# 毎日深夜2時に実行（30日以上のログを削除）
0 2 * * * cd /path/to/daily_log && python cleanup_old_logs.py

# 毎週日曜日に実行（60日以上のログを削除）
0 3 * * 0 cd /path/to/daily_log && ./cleanup_old_logs.sh --days 60
```

## 📊 日誌の活用方法

### 1. プロジェクト振り返り
```bash
# 特定期間の日誌を抽出
grep -l "Phase 2" 2025-08-*_workingLog.md

# 特定部門の活動を追跡
grep -A 10 "## 💻 システム開発部" *.md
```

### 2. パフォーマンス分析
```python
# 日誌からメトリクスを抽出
import re
import glob

for log_file in glob.glob("*_workingLog.md"):
    with open(log_file, 'r', encoding='utf-8') as f:
        content = f.read()
        # テストカバレッジを抽出
        coverage = re.findall(r'カバレッジ[：:]\s*(\d+)%', content)
        if coverage:
            print(f"{log_file}: {coverage[0]}%")
```

### 3. 問題分析
```bash
# エラーや問題を検索
grep -i "error\|失敗\|問題\|課題" *_workingLog.md

# Critical バグの追跡
grep -B 5 -A 5 "Critical" *_workingLog.md
```

## 🔒 セキュリティとプライバシー

### 機密情報の取り扱い
- ❌ パスワード、APIキー、トークンは記録しない
- ❌ 個人情報（実在の人物名、メールアドレス等）は記録しない
- ⚠️ 顧客情報は匿名化または一般化して記録
- ✅ 技術的詳細は積極的に記録

### アクセス制御
```bash
# 適切な権限設定
chmod 640 *_workingLog.md  # 所有者:読み書き、グループ:読み取り
chmod 750 cleanup_*.sh      # スクリプトは実行可能
chmod 333 .private/         # 書き込みのみ（読み取り不可）
```

### アクセス権限の詳細
- **ユーザー（唯一の閲覧者）**: 
  - ✅ 全ログの読み取り権限
  - ✅ パフォーマンス監視
  - ✅ 面談等の指示権限
  
- **CTO（記録対象）**:
  - ✅ ログ書き込み（プロジェクト解析から）
  - ❌ ログ読み取り不可
  - ❌ 他メンバーのパフォーマンス閲覧不可
  
- **全部門（記録対象）**:
  - ✅ 自部門のログ書き込み
  - ❌ ログ読み取り不可
  - ✅ tasksフォルダでの情報共有のみ可

## 📈 品質基準

### 良い日誌の例
```markdown
#### 14:00 - API設計レビュー
- **受信指示**: ← CTO: 「決済APIの設計レビュー実施」
- **思考**: 「既存の決済システムとの互換性を保ちつつ、
           新しいセキュリティ要件を満たす必要がある」
- **行動**: 
  - OpenAPI仕様書の作成
  - セキュリティチームとの協議
  - パフォーマンステスト計画策定
- **決定**: 「JWT認証 + OAuth2.0を採用」
- **根拠**: 「業界標準準拠、既存システムとの親和性高」
- **報告**: → CTO: 「設計完了、実装開始可能」
```

### 避けるべき日誌の例
```markdown
#### 14:00
作業した
問題なし
```

## 🚀 ベストプラクティス

### 1. 即時記録
- 作業完了後すぐに記録（記憶が新鮮なうちに）
- バッファリングせず、リアルタイムで更新

### 2. 構造化記録
- マークダウン形式を活用
- 表形式でメトリクスを整理
- コードブロックで技術的詳細を記載

### 3. 追跡可能性
- チケット番号やコミットハッシュを含める
- 関連ドキュメントへのリンクを追加
- タイムスタンプを正確に記録

### 4. 継続的改善
- 日誌から得られた知見を次の作業に活用
- 繰り返し発生する問題を特定し、根本解決
- 成功パターンを標準化

## 🔧 トラブルシューティング

### Q: 日誌ファイルが大きくなりすぎた
```bash
# 大きなファイルを分割
split -l 1000 large_workingLog.md split_log_

# 圧縮して保存
gzip 2025-07-*_workingLog.md
```

### Q: 削除スクリプトが動作しない
```bash
# 権限を確認
ls -la cleanup_old_logs.*

# 実行権限を付与
chmod +x cleanup_old_logs.sh

# Pythonバージョンを確認
python --version  # Python 3.6以上が必要
```

### Q: 日誌の検索が遅い
```bash
# インデックスを作成
grep -l "" *.md > index.txt

# ripgrepを使用（高速）
rg "検索キーワード" --type md
```

## 📞 サポート

### 問題報告
- **担当**: 品質保証部
- **方法**: GitHubイシューまたは内部チケット
- **SLA**: 24時間以内に初回応答

### 機能要望
- **担当**: 経営企画部
- **評価基準**: ROI、実装難易度、需要
- **リリースサイクル**: 月次

---

## 📅 更新履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0.0 | 2025-08-17 | 初版作成 |
| v1.1.0 | (予定) | 自動集約機能追加 |
| v1.2.0 | (予定) | AI分析機能統合 |

---

**最終更新**: 2025-08-17  
**管理責任者**: CTO（階層型エージェントシステム）  
**ドキュメントバージョン**: 1.0.0

---
*このドキュメントは階層型エージェントシステムの作業日誌管理基準を定めています*