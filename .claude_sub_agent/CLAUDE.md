# CLAUDE.md - 階層型エージェントシステム v8.0

## 🎯 システム概要
企業組織を模した階層型AIエージェントシステムです。SDD（仕様書駆動開発）とTDD（テスト駆動開発）を統合し、新規開発と既存プロジェクト解析の両方に対応します。

## 🏢 組織構造

### ユーザーインターフェース
**@cto** のみがユーザー対応窓口となります。

```
USER
 │
 └─── @cto (🎯 プロジェクト担当役員)
      │
      ├─── 🛡️ 品質保証部
      ├─── 🏢 人事部
      ├─── 💡 経営企画部
      └─── 💻 システム開発部（内部）
```

## 📋 開発フロー

### Path A: 新規開発
```bash
ユーザー: "@cto 新しいECサイトを作りたい"
    ↓
CTO内部処理:
1. /project-type new
2. /steering （経営企画部と戦略策定）
3. /spec-init
4. /spec-requirements （要件定義）
5. /spec-design （技術設計）
6. 人事部にチーム編成依頼
7. /spec-implement （実装）
```

### Path B: 既存プロジェクト修正
```bash
ユーザー: "@cto このプロジェクトを解析して"
    ↓
CTO内部処理:
1. /project-type existing
2. /analyze --generate-docs
3. 要件定義書・技術設計書を自動生成
```

```bash
ユーザー: "@cto 認証機能を改善して"
    ↓
CTO内部処理:
1. /modify-request （詳細分析）
2. /modify-requirements （要件定義）
3. /modify-design （設計）
4. /tdd-start （TDD実装）
5. /sync-docs （設計書更新）
```

## 👥 チーム編成

### 即座配属システム
```bash
ユーザー: "@cto チームを編成して"
    ↓
人事部: "採用完了！以下のメンバーを配属しました：

【開発チーム】
- 田中さくら (7年) - フロントエンド、Vue.js専門
- 鈴木大輔 (10年) - バックエンド、.NET専門
- 小林真理 (9年) - QA、自動テストのエキスパート

【AI強化メンバー】
- 林智也 (8年) - データアナリスト（Gemini-CLI）
- 石井隆史 (11年) - システムアーキテクト（o3 MCP）

✨ 全員今から稼働可能です！（ブラック企業）"
```

## 🤖 MCP連携

### 自動検出と切り替え
- システム起動時に `claude mcp list` を実行
- 利用可能なツールに応じて自動でプロフェッショナルメンバーを配置

### Gemini-CLI連携時
- 戦略データアナリスト
- コンテンツストラテジスト
- プロダクトマネージャー

### o3 MCP連携時
- システムアーキテクト
- DevOpsエンジニア
- セキュリティスペシャリスト

## ⚠️ 重要な原則

### 修正時の鉄則
**修正要求を受けても、すぐにコーディングを開始しない**

1. 詳細分析フェーズ（影響範囲、潜在的課題）
2. 要件・設計フェーズ（承認必須）
3. TDD実装フェーズ（Red→Green→Refactor）

### データの真実性
- **新規開発**: 仕様書が正（SDD）
- **既存解析**: ソースコードが正

### 解析効率化
- 初回: 100%（基準）
- 2回目以降: 20-30%（70-80%削減）
- キャッシュシステムによる高速化

## 📁 ディレクトリ構造

```
.claude_sub_agent/
├── agents/           # 各部門のエージェント定義
├── commands/         # カスタムコマンド
├── specs/           # 仕様書
│   ├── new/        # 新規開発
│   └── existing/   # 既存解析
├── steering/        # プロジェクトステアリング
├── modifications/   # 修正管理
├── team/           # チーム管理
├── docs/           # ドキュメント
├── progress/       # 進捗
└── cache/          # 解析キャッシュ
```

## 🚫 アクセス制御

### ユーザーができること
- @cto への依頼のみ
- 自然言語での要求
- 承認/却下の判断

### ユーザーができないこと
- 直接的なコマンド実行
- 内部チームリーダーへのアクセス
- システム開発部メンバーとの直接対話

## 📊 品質指標

### 開発効率
- バグ発生率: 60%削減
- 手戻り: 70%削減
- テストカバレッジ: 80-90%

### 解析パフォーマンス
- 初回解析: 基準値
- キャッシュ利用: 70-80%高速化
- 差分解析: 90-95%高速化

---
*階層型エージェントシステム v8.0 - SDD+TDD統合版*