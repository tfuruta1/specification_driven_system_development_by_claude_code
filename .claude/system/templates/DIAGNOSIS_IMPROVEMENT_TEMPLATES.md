# 診断問題解決テンプレート集 - AI往復最適化版

## 🎯 概要

自己診断システムで発見された問題を**AI往復3-5回で解決**するための実装依頼テンプレート集  
参考: https://zenn.dev/sakupanda/articles/ecb4ae7e9a240e

---

## 📋 テンプレート一覧

### 1. テストカバレッジ不足解決テンプレート

#### 診断結果例
```
カテゴリ: TEST_COVERAGE
重要度: HIGH
説明: テストカバレッジ 16.5% (目標: 95%以上)
影響モジュール: system/core/*.py
```

#### AI一括実装依頼
```
【テストカバレッジ向上 - AI往復最適化実装依頼】

## 現状分析
- **現在のカバレッジ**: 16.5%
- **目標カバレッジ**: 95%以上
- **カバレッジ不足モジュール**: [自動特定されたモジュールリスト]

## 一括実装要求
AI_COLLABORATION_CONTEXT.mdに基づき、以下を**一括で実行**してください:

### 1. 自動テスト生成 (TDD対応)
- RED Phase: 各モジュールの異常系テスト
- GREEN Phase: 各モジュールの正常系テスト  
- Edge Cases: 境界値・エラーハンドリングテスト

### 2. テスト実行・検証
- 全テスト実行とカバレッジ測定
- 95%未達成の場合は追加テスト生成
- 統合テスト確認

### 3. 自動修正対応
エラー発生時は以下を自動試行:
- インポートパス修正
- モックオブジェクト追加
- テストデータ作成

## 成功基準
- [ ] テストカバレッジ95%以上達成
- [ ] 全テスト正常実行
- [ ] CI/CD統合確認

## 検証コマンド
```bash
python -m pytest project/tests/ --cov=system/core --cov-report=term-missing -v
python -m coverage report --fail-under=95
lefthook run tdd-cycle
```

**重要**: エラー時は自動修正し、最終的に95%カバレッジを達成してください。
```

---

### 2. モジュールインポートエラー解決テンプレート

#### 診断結果例
```
カテゴリ: MODULE_IMPORT
重要度: HIGH  
説明: 5個のモジュールでインポートエラー
影響モジュール: [error_handler.py, alex_team_core.py, ...]
```

#### AI一括実装依頼
```
【モジュールインポートエラー解決 - AI往復最適化実装依頼】

## エラー分析
- **エラー発生モジュール**: [診断で特定されたモジュール]
- **エラー内容**: [具体的なエラーメッセージ]
- **関連する依存関係**: [影響を受ける他モジュール]

## 一括実装要求
AI_COLLABORATION_CONTEXT.mdに基づき、以下を**一括で実行**してください:

### 1. インポートエラー修正
- 欠落したインポート文の追加
- 相対インポートパスの修正  
- fallbackインポート機構の実装

### 2. 依存関係整理
- 循環インポートの解消
- 共通定義の統合 (common_base.py活用)
- パス設定の標準化

### 3. 統合テスト・検証
- 全モジュールのインポート確認
- 依存関係の健全性確認
- 既存機能の動作確認

### 4. 自動修正対応
エラー発生時は以下を自動試行:
- importlib.util活用のダイナミックインポート
- sys.path設定の調整
- __init__.py の適切な配置

## 成功基準
- [ ] 全モジュールのインポートエラー解消
- [ ] 依存関係チェック通過
- [ ] 既存テスト正常実行

## 検証コマンド
```bash
python -c "import sys; sys.path.insert(0, 'system'); from core import *; print('All imports successful')"
python system/core/dependency_checker.py
python -m pytest project/tests/ -v --tb=short
```

**重要**: 全インポートエラーを解消し、動作確認まで完了してください。
```

---

### 3. 循環依存関係解決テンプレート

#### 診断結果例
```
カテゴリ: CIRCULAR_DEPENDENCIES
重要度: HIGH
説明: 3つの循環依存パスを検出
影響モジュール: システム全体のアーキテクチャ
```

#### AI一括実装依頼
```
【循環依存解決 - AI往復最適化実装依頼】

## 循環依存分析
- **循環パス数**: 3つ
- **影響モジュール**: [具体的な循環経路]
- **アーキテクチャ影響**: [システム設計への影響度]

## 一括実装要求
AI_COLLABORATION_CONTEXT.mdに基づき、以下を**一括で実行**してください:

### 1. 循環依存解消実装
- インターフェース抽出による依存分離
- 依存性注入パターンの適用
- モジュール分割・責任分離

### 2. アーキテクチャ改善
- レイヤードアーキテクチャの適用
- 共通基盤モジュール (common_base.py) の活用
- 設定・ユーティリティの分離

### 3. 統合テスト・動作確認
- 循環依存チェッカーでの検証
- 全機能の動作確認
- パフォーマンス影響確認

### 4. 自動修正対応
問題発生時は以下を自動試行:
- 代替アーキテクチャパターンの適用
- プロキシパターンの導入
- 遅延初期化の実装

## 成功基準
- [ ] 循環依存の完全解消
- [ ] アーキテクチャ品質向上
- [ ] 全機能の正常動作

## 検証コマンド
```bash
python system/core/dependency_checker.py
python -m pytest project/tests/ -v
lefthook run ai-ready
```

**重要**: 循環依存を完全に解消し、システム安定性を確保してください。
```

---

### 4. パフォーマンス最適化テンプレート

#### 診断結果例
```
カテゴリ: MEMORY_USAGE
重要度: MEDIUM
説明: メモリ使用量 150MB (目標: 50MB以下)
影響モジュール: 全システム
```

#### AI一括実装依頼
```
【パフォーマンス最適化 - AI往復最適化実装依頼】

## パフォーマンス分析
- **現在メモリ使用量**: 150MB
- **目標使用量**: 50MB以下
- **最適化対象**: [メモリ使用量の多いモジュール]

## 一括実装要求
AI_COLLABORATION_CONTEXT.mdに基づき、以下を**一括で実行**してください:

### 1. メモリ最適化実装
- オブジェクトプールパターンの導入
- 遅延読み込み (lazy loading) の実装
- キャッシュサイズの最適化

### 2. パフォーマンス改善
- 不要なオブジェクト参照の削除
- ガベージコレクション最適化
- メモリリーク対策

### 3. 検証・測定
- メモリ使用量の継続測定
- パフォーマンステストの実行
- ボトルネック分析

### 4. 自動修正対応
効果不十分時は以下を自動試行:
- より積極的なキャッシュクリア
- オブジェクト生成パターンの変更
- 代替アルゴリズムの適用

## 成功基準
- [ ] メモリ使用量50MB以下達成
- [ ] パフォーマンス劣化なし
- [ ] 安定性維持

## 検証コマンド
```bash
python -c "import psutil, sys; print(f'Memory: {psutil.Process().memory_info().rss/1024/1024:.1f}MB')"
python -m pytest project/tests/ --benchmark
lefthook run performance-test
```

**重要**: メモリ使用量を50MB以下に削減し、動作確認してください。
```

---

### 5. コード品質改善テンプレート

#### 診断結果例
```
カテゴリ: YAGNI_VIOLATION
重要度: MEDIUM
説明: 過剰なテストファイル (34個) の統合が必要
影響モジュール: project/tests/
```

#### AI一括実装依頼
```
【コード品質改善 - AI往復最適化実装依頼】

## 品質問題分析
- **YAGNI違反**: 過剰なテストファイル (34個)
- **目標**: 10-15個への統合
- **統合戦略**: 機能別・モジュール別統合

## 一括実装要求
AI_COLLABORATION_CONTEXT.mdに基づき、以下を**一括で実行**してください:

### 1. テストファイル統合
- 類似機能テストのマージ
- 重複テストケースの削除
- テストクラスの階層化

### 2. コード品質向上
- YAGNI/DRY/KISS原則の適用
- 重複コードの共通関数化
- 可読性・保守性の向上

### 3. 統合後検証
- 全テストの正常実行確認
- テストカバレッジ維持確認
- CI/CD統合確認

### 4. 自動修正対応
問題発生時は以下を自動試行:
- テストデータの調整
- アサーション修正
- モック設定の統合

## 成功基準
- [ ] テストファイル数を10-15個に削減
- [ ] 全テスト正常実行
- [ ] カバレッジ95%以上維持

## 検証コマンド
```bash
find project/tests -name "test_*.py" | wc -l
python -m pytest project/tests/ --cov=system/core --cov-report=term-missing -v
lefthook run tdd-cycle
```

**重要**: ファイル数を削減しつつ、品質とカバレッジを維持してください。
```

---

## 🚀 使用方法

### Step 1: 診断実行
```bash
cd .claude
python system/core/optimized_self_diagnosis_system.py
```

### Step 2: 生成された改善提案の確認
診断レポートから該当する問題のAI実装依頼をコピー

### Step 3: AI往復最適化実装
上記テンプレートをAIに送信し、一括実装を依頼

### Step 4: 検証
```bash
lefthook run ai-ready  # 全体的な準備確認
```

---

## 💡 AI往復最適化のポイント

### 従来のアプローチ (20往復)
1. 「テストカバレッジが低いです」
2. 「どのモジュールが不足？」  
3. 「○○モジュールです」
4. 「テスト作って」
5. 「エラーが出ます」
6. 「インポート修正して」
...（20往復）

### 最適化アプローチ (3-5往復)
1. **完全な仕様書 + 一括実装依頼**（上記テンプレート使用）
2. **統合確認・微調整**
3. **最終動作確認**

**効果**: **75-85%の往復削減、2-3時間→30-45分の時間短縮**

---

**Created by**: Alex Team Optimized Diagnosis System v15.0