# /architecture - システムアーキテクチャ設計コマンド

## 目的
o3 MCPのシステムアーキテクトとして、MCPプロトコルによる外部システム連携能力を活用し、大規模システムアーキテクチャ設計・マイクロサービス構成・外部システム統合を実行します。

## 対象AI
- **o3 MCP**: MCPプロトコル連携、リアルタイムシステム構成変更、複雑統合設計能力を活用

## 入力パラメータ
- **必須**: `$ARCHITECTURE_TYPE` - アーキテクチャタイプ（system_design, microservices, integration, scalability, migration）
- **任意**: `$SCALE_LEVEL` - スケールレベル（small, medium, large, enterprise）
- **任意**: `$INTEGRATION_SCOPE` - 統合範囲（internal, external, hybrid, cloud_native）
- **任意**: `$PERFORMANCE_TARGET` - パフォーマンス目標（standard, high_performance, real_time, batch_processing）

## 出力
- **アーキテクチャ設計書**: `.tmp/architecture_design_[timestamp].md`
- **システム構成図**: `.tmp/system_diagrams/`
- **統合仕様書**: `.tmp/integration_specs.md`
- **実装ガイド**: `.tmp/implementation_guide.md`
- **移行計画書**: `.tmp/migration_plan.md`

## ワークフロー

### Phase 1: 要件分析・制約調査
```markdown
## 要件分析フェーズ

### 1. 機能要件・非機能要件分析
- ビジネス機能要件の詳細化
- パフォーマンス・可用性・拡張性要件
- セキュリティ・コンプライアンス要件
- 運用・保守要件

### 2. 制約・前提条件調査
- 既存システム・レガシー制約
- 技術スタック・プラットフォーム制約
- 予算・リソース・スケジュール制約
- 組織・チーム・スキル制約

### 3. 外部システム・依存関係調査
- 既存システム・データベース調査
- 外部API・サービス依存関係
- データフロー・統合ポイント特定
- ベンダー・サードパーティ制約

### 4. 品質属性・トレードオフ分析
- パフォーマンス vs. コスト
- 可用性 vs. 一貫性
- セキュリティ vs. 利便性
- 拡張性 vs. 複雑性
```

### Phase 2: アーキテクチャ設計
```markdown
## アーキテクチャ設計フェーズ

### 1. 論理アーキテクチャ設計
- ドメイン分析・境界定義
- コンポーネント・モジュール設計
- レイヤー・階層構造設計
- データフロー・制御フロー設計

### 2. 物理アーキテクチャ設計
- システム配置・ネットワーク構成
- サーバー・インフラ構成
- データベース・ストレージ設計
- 負荷分散・冗長化設計

### 3. 統合アーキテクチャ設計
- API・メッセージング設計
- データ統合・ETL設計
- セキュリティ・認証認可設計
- 監視・ログ・運用設計

### 4. 技術選定・評価
- フレームワーク・ライブラリ選定
- データベース・ミドルウェア選定
- クラウド・インフラサービス選定
- 開発・運用ツール選定
```

### Phase 3: 詳細設計・実装指針
```markdown
## 詳細設計フェーズ

### 1. コンポーネント詳細設計
- インターフェース・API詳細仕様
- データモデル・スキーマ設計
- ビジネスロジック・アルゴリズム設計
- エラーハンドリング・例外処理設計

### 2. データアーキテクチャ設計
- データモデル・正規化設計
- データフロー・バッチ処理設計
- データ品質・ガバナンス設計
- バックアップ・災害復旧設計

### 3. セキュリティアーキテクチャ設計
- 認証・認可・アクセス制御
- データ暗号化・通信セキュリティ
- 脅威分析・セキュリティ対策
- コンプライアンス・監査対応

### 4. 運用アーキテクチャ設計
- 監視・メトリクス・アラート設計
- ログ管理・分析基盤設計
- デプロイ・リリース戦略設計
- 障害対応・復旧手順設計
```

## アーキテクチャタイプ別仕様

### 1. システム設計（system_design）
```yaml
目的: 全体システムアーキテクチャの設計・最適化
成果物:
  - システム全体アーキテクチャ図
  - コンポーネント設計書
  - データフロー図
  - 技術選定・評価書
設計要素:
  - 論理・物理アーキテクチャ
  - システム境界・インターフェース
  - 品質属性・非機能要件
  - 技術スタック・プラットフォーム選定
```

### 2. マイクロサービス（microservices）
```yaml
目的: マイクロサービスアーキテクチャの設計・移行
成果物:
  - サービス分割・境界設計
  - サービス間通信設計
  - データ管理・一貫性戦略
  - 運用・監視戦略
設計要素:
  - ドメイン駆動設計・境界コンテキスト
  - API・メッセージング戦略
  - データベース・ストレージ戦略
  - DevOps・CI/CD戦略
```

### 3. システム統合（integration）
```yaml
目的: 複数システム・外部サービスとの統合設計
成果物:
  - 統合アーキテクチャ図
  - API・データ統合仕様
  - セキュリティ・ガバナンス設計
  - 統合テスト・運用計画
設計要素:
  - 統合パターン・プロトコル選定
  - データ変換・マッピング
  - エラーハンドリング・補償処理
  - パフォーマンス・可用性設計
```

### 4. スケーラビリティ（scalability）
```yaml
目的: 高負荷・大規模システム対応のアーキテクチャ設計
成果物:
  - スケーラビリティ戦略
  - 負荷分散・キャッシュ設計
  - データベース・ストレージ最適化
  - パフォーマンス監視・チューニング計画
設計要素:
  - 水平・垂直スケーリング戦略
  - キャッシュ・CDN活用
  - データベースシャーディング・レプリケーション
  - 非同期処理・メッセージキュー
```

### 5. システム移行（migration）
```yaml
目的: レガシーシステムからの移行・モダナイゼーション
成果物:
  - 移行戦略・ロードマップ
  - 段階的移行計画
  - データ移行・同期設計
  - リスク評価・緩和策
設計要素:
  - Strangler Fig・Big Bang戦略選択
  - データ移行・整合性保証
  - 並行運用・切り替え戦略
  - 回帰・ロールバック計画
```

## 成果物テンプレート

### システムアーキテクチャ設計書構成
```markdown
# システムアーキテクチャ設計書

## エグゼクティブサマリー
- アーキテクチャ概要・主要特徴
- ビジネス価値・技術的利点
- 主要な設計決定・トレードオフ
- 実装・移行コスト・期間

## ビジネス要件・制約
### ビジネス要件
- 機能要件・ユースケース
- 非機能要件（パフォーマンス・可用性・セキュリティ）
- 品質属性・サービスレベル
- コンプライアンス・規制要件

### 制約・前提条件
- 技術的制約・既存システム制約
- 予算・リソース・スケジュール制約
- 組織・プロセス・スキル制約
- 外部依存・ベンダー制約

## アーキテクチャ概要
### 論理アーキテクチャ
```
[システム全体図 - コンポーネント・レイヤー構成]

主要コンポーネント:
- Presentation Layer: UI・API Gateway
- Business Logic Layer: アプリケーションサービス
- Data Access Layer: データベース・外部システム連携
- Infrastructure Layer: 認証・監視・セキュリティ
```

### 物理アーキテクチャ
```
[デプロイメント図 - サーバー・ネットワーク構成]

インフラ構成:
- Load Balancer: 負荷分散・SSL終端
- Web Servers: アプリケーションサーバー（複数台）
- Database Servers: プライマリ・レプリカ構成
- Cache Servers: Redis・Memcached
- Monitoring: Prometheus・Grafana・ELK Stack
```

## 詳細設計
### コンポーネント設計
#### [コンポーネント名]
- **目的・責務**: [コンポーネントの役割・責任範囲]
- **インターフェース**: [API・メソッド仕様]
- **依存関係**: [他コンポーネント・外部システムとの関係]
- **データモデル**: [扱うデータ・エンティティ]
- **品質属性**: [パフォーマンス・可用性要件]

### データアーキテクチャ
#### データモデル設計
- エンティティ関係図（ER図）
- データベーススキーマ設計
- インデックス・パーティション戦略
- データライフサイクル・アーカイブ戦略

#### データフロー設計
- バッチ処理・ETLフロー
- リアルタイムデータ処理
- データ同期・レプリケーション
- データ品質・バリデーション

### セキュリティアーキテクチャ
#### 認証・認可
- 認証方式（OAuth2・SAML・JWT）
- 認可モデル（RBAC・ABAC）
- シングルサインオン（SSO）
- 多要素認証（MFA）

#### データ保護
- データ暗号化（保存時・転送時）
- 個人情報保護・GDPR対応
- アクセスログ・監査証跡
- データ漏洩防止（DLP）

## 技術選定・評価
### 技術スタック
| 層 | 技術 | 選定理由 | 代替案 |
|---|------|----------|--------|
| Frontend | Vue.js 3 | Composition API・エコシステム | React・Angular |
| Backend | Node.js | JavaScript統一・パフォーマンス | Python・Java |
| Database | PostgreSQL | ACID・拡張性・コスト | MySQL・MongoDB |
| Cache | Redis | 高性能・データ構造サポート | Memcached |
| Messaging | RabbitMQ | 信頼性・機能豊富 | Kafka・Redis Pub/Sub |

### 評価基準・比較
- パフォーマンス・拡張性
- 開発・運用・学習コスト
- コミュニティ・サポート・成熟度
- ライセンス・ベンダーロックイン

## 品質・リスク分析
### 品質属性分析
#### パフォーマンス
- 応答時間目標: API < 200ms, 画面表示 < 2s
- スループット目標: 1000 req/sec
- 同時接続数: 10,000 users
- リソース使用率: CPU < 70%, Memory < 80%

#### 可用性・信頼性
- 稼働率目標: 99.9% (月間停止時間 < 43分)
- 障害復旧時間: MTTR < 30分
- データ整合性・耐障害性
- 災害復旧・バックアップ戦略

### リスク分析・緩和策
#### 技術リスク
1. **新技術導入リスク**
   - 影響: 開発遅延・品質低下
   - 確率: Medium
   - 緩和策: PoC実施・段階的導入・トレーニング

2. **パフォーマンスリスク**
   - 影響: SLA違反・ユーザー満足度低下
   - 確率: Medium
   - 緩和策: 負荷テスト・監視強化・キャッシュ活用

#### 運用リスク
1. **運用複雑性リスク**
   - 影響: 運用コスト増・障害対応遅延
   - 確率: High
   - 緩和策: 自動化・監視・運用手順整備

## 実装・移行計画
### 実装フェーズ
#### Phase 1: インフラ・基盤構築（1-2ヶ月）
- 開発・ステージング・本番環境構築
- CI/CD パイプライン構築
- 監視・ログ基盤構築
- セキュリティ基盤構築

#### Phase 2: コア機能実装（2-4ヶ月）
- 認証・認可機能
- マスタデータ管理
- 基本CRUD機能
- API・統合機能

#### Phase 3: 高度機能・最適化（2-3ヶ月）
- 複雑ビジネスロジック
- パフォーマンス最適化
- 運用機能強化
- セキュリティ強化

### 移行戦略
- 段階的移行 vs. 一括移行
- データ移行・同期戦略
- 並行運用・切り替え計画
- ロールバック・緊急対応計画

## 運用・保守
### 監視・運用
- システム監視・アラート設定
- パフォーマンス監視・レポート
- ログ管理・分析
- 定期メンテナンス・バックアップ

### 保守・改善
- 技術的負債管理
- セキュリティパッチ・更新
- 機能追加・変更対応
- 廃止・終了計画
```

## 連携コマンド
- **← /product-plan**: プロダクト要件に基づくアーキテクチャ設計
- **→ /devops**: アーキテクチャに基づくインフラ・運用設計
- **→ /security**: セキュリティアーキテクチャの詳細化  
- **→ /design**: アーキテクチャ制約を反映した詳細設計

## 品質チェックリスト
- [ ] ビジネス要件・非機能要件の適切な反映
- [ ] 拡張性・保守性・可用性の考慮
- [ ] セキュリティ・コンプライアンス要件の満足
- [ ] 技術選定の妥当性・リスク評価
- [ ] 実装・運用の現実性・コスト妥当性

## 使用例

### 大規模システム設計
```bash
/architecture system_design --scale_level="large" --integration_scope="hybrid" --performance_target="high_performance"
```

### マイクロサービス移行
```bash
/architecture microservices --scale_level="medium" --integration_scope="cloud_native"
```

### 外部システム統合
```bash
/architecture integration --integration_scope="external" --performance_target="real_time"
```