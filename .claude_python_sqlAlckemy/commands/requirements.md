---
allowed-tools: TodoWrite, TodoRead, Read, Write, MultiEdit, Bash(mkdir:*)
description: FastAPI + SQLAlchemy 製造業システムの要件定義を作成 (仕様書駆動開発 Step 1)
---

## Context
- タスク要求: $ARGUMENTS

## Your task

### 1. ディレクトリ作成
- `.tmp` ディレクトリが存在しない場合は作成
- プロジェクトルートに `.claude` ディレクトリ構造を確認・作成

### 2. 製造業ユーザー要求の分析
提供された製造業タスク説明を詳細に分析し、以下を抽出：
- 解決すべき製造業中核的な問題
- 明示されていない製造業暗黙の要件
- FastAPI + SQLAlchemy 製造業技術スタックに特有の考慮事項
- 製造業想定されるエッジケースと制約
- 製造業成功基準

### 3. 製造業要件定義書の作成
`.tmp/manufacturing_requirements.md` を以下の構造で作成：

```markdown
# 製造業要件定義書 - [製造業プロジェクト名]

## 1. 製造業プロジェクト概要
### 1.1 製造業目的
[この製造業プロジェクトが解決する製造業問題と目指すゴール]

### 1.2 製造業対象ユーザー
[製造業プライマリ・セカンダリユーザーとその製造業ニーズ]

### 1.3 製造業技術スタック確認
- バックエンド: FastAPI (Python 3.9+)
- ORM: SQLAlchemy 2.0 (非同期対応)
- データベース: PostgreSQL 13+
- マイグレーション: Alembic
- バリデーション: Pydantic v2
- タスクキュー: Celery + Redis
- キャッシュ: Redis
- コンテナ: Docker + Docker Compose
- 監視: Prometheus + Grafana
- IoT連携: MQTT, Modbus, OPC-UA

## 2. 製造業機能要件

### 2.1 製造業必須機能 (MVP)
- [ ] [生産管理機能]: [ワークオーダー管理、生産スケジューリング、バッチ追跡のFastAPI実装方針]
- [ ] [品質管理機能]: [検査記録、不良品管理、SPC管理のSQLAlchemyモデル設計]
- [ ] [在庫管理機能]: [原材料・製品在庫、安全在庫管理の非同期処理]

### 2.2 製造業推奨機能
- [ ] [予防保全管理]: [設備メンテナンススケジューリング、故障予測]
- [ ] [IoTデータ連携]: [センサーデータ収集、リアルタイム監視]

### 2.3 製造業オプション機能
- [ ] [MES統合]: [製造実行システムとのデータ連携]
- [ ] [AI品質予測]: [機械学習による品質予測]

## 3. FastAPI + SQLAlchemy 製造業固有の要件

### 3.1 製造業API設計要件
- FastAPIの自動OpenAPIドキュメント生成活用
- Pydantic v2による製造業データバリデーション
- 非同期処理による高スループット実現
- JWTによるステートレス認証

### 3.2 製造業データモデル要件
- SQLAlchemy 2.0の新しい構文でのモデル定義
- 非同期ORMセッションの適切な管理
- 製造業データのリレーションシップ設計
- Alembicによるスキーママイグレーション管理

### 3.3 製造業パフォーマンス要件
- コネクションプールによるデータベース接続最適化
- Redisキャッシュによる頻繁アクセスデータの高速化
- Celeryによる重い処理の非同期実行

## 4. 製造業データベース連携要件

### 4.1 製造業データベース要件
- PostgreSQLによる製造業データモデル設計
- ACID特性による製造業データ整合性保証
- 制約とインデックスによるパフォーマンス最適化
- 時系列データの効率的な保存・取得

### 4.2 製造業データアクセス要件
- 非同期SQLAlchemyセッションの適切なライフサイクル管理
- トランザクションによる製造業データ一貫性保証
- 製造業特有のデータアクセスパターン
- バッチ処理とリアルタイム処理の併用

### 4.3 製造業データセキュリティ要件
- 製造業機密データの適切な暗号化保存
- ロールベースアクセス制御(RBAC)
- 製造業データアクセスログの記録と監査

## 5. 製造業非機能要件

### 5.1 製造業パフォーマンス
- FastAPIの非同期機能活用による高速応答
- SQLAlchemyコネクションプール最適化
- メモリ効率とCPU使用率の最適化
- 大量データ処理のストリーミング処理

### 5.2 製造業信頼性
- 製造ライン停止を防ぐ高可用性設計
- 製造業データバックアップと復旧戦略
- 異常状況でのグレースフルデグラデーション
- 製造業システムヘルスチェック機能

### 5.3 製造業保守性
- 模略的なサービス層設計によるビジネスロジック分離
- テスト可能なアーキテクチャ構造
- 製造業ドメイン知識の適切なカプセル化
- コード可読性とドキュメンテーション

## 6. 製造業制約事項

### 6.1 製造業技術的制約
- Python 3.9+ の使用 (非同期機能必須)
- PostgreSQL 13+のサポートバージョン
- 製造業システム特有のブラウザ対応範囲
- 製造環境のネットワーク制約とセキュリティ要件

### 6.2 製造業プロジェクト制約
- 製造業開発期間とリソース制限
- 製造業システムの運用コストとライセンス費
- 製造業コンプライアンス要件 (ISO9001, GMP, FDA等)
- 製造業データ残留とプライバシー保護

## 7. 製造業成功基準

### 7.1 製造業完了の定義
- [ ] [製造業明確な完了条件1: 生産ラインでの実際の動作確認]
- [ ] [製造業明確な完了条件2: 品質データの正確な収集と分析]
- [ ] [FastAPI + SQLAlchemy 製造業アプリケーションとしての品質基準]
- [ ] [製造業データベース連携の動作確認とパフォーマンス測定]

### 7.2 製造業受け入れテスト
- [製造業ユーザーが製造業効率向上を実感する条件]
- [製造業技術的な品質基準: API応答速度、データ整合性、セキュリティ]
- [製造業コンプライアンス基準: データ保存期間、アクセス権限管理]

## 8. 製造業想定されるリスク

### 8.1 製造業技術的リスク
- FastAPI + SQLAlchemy 2.0 の新機能に関する学習コスト
- 製造業レガシーシステムとの統合リスク
- 製造業大容量データ処理に関するパフォーマンスリスク
- 対策: [プロトタイプ開発、段階的マイグレーション、パフォーマンステスト]

### 8.2 製造業プロジェクトリスク
- 製造業ドメイン知識の習得に伴う開発工数の見積もりリスク
- 製造業システム統合に伴うテスト複雑化リスク
- 製造業コンプライアンス要件変更に伴う仕様変更リスク
- 対策: [製造業エキスパートの早期関与、アジャイル開発手法、継続的コミュニケーション]

## 9. 製造業設計フェーズでの検討事項
- 製造業データモデル構造の詳細設計
- 製造業サービスレイヤー設計とビジネスロジック分離
- FastAPI ルーター構成とAPIエンドポイント設計
- SQLAlchemyモデルとリレーションシップ設計
- Alembicマイグレーション戦略とバージョニング
- 製造業セキュリティモデルと認証・認可設計
- 製造業パフォーマンス最適化戦略
- 製造業テスト戦略と品質保証手法
- 製造業モニタリングとログ設計
- 製造業デプロイメント戦略とCI/CDパイプライン
```

### 4. 製造業TODO エントリーの作成
TodoWrite を使用して「製造業要件定義の完了とレビュー」をタスクとして追加

### 5. 製造業ユーザーへの提示
作成した製造業要件定義書を表示し、以下を確認：
- 製造業要件の理解が正しいか
- 漏れている製造業要件はないか
- FastAPI + SQLAlchemy 製造業技術スタックに特有の考慮漏れはないか
- 製造業設計フェーズに進む許可

## 重要な注意点
- FastAPIの非同期処理とPydantic v2の特性を考慮した製造業要件定義
- SQLAlchemy 2.0の新しいORM機能と非同期セッションを活用した製造業データ設計
- 製造業ドメイン固有のビジネスルールと制約を考慮した設計
- 製造業システムの高可用性とパフォーマンス要件
- 製造業コンプライアンスとセキュリティ要件への対応
- 実装の現実性を重視した製造業要件設定

Think hard and create comprehensive manufacturing requirements that leverage the full potential of the FastAPI + SQLAlchemy + Manufacturing Domain tech stack.
