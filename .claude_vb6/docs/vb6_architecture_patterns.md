# ğŸ›ï¸ VB6 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¬ã‚¤ãƒ‰

**Visual Basic 6.0ã«ãŠã‘ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…**

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [MVPãƒ‘ã‚¿ãƒ¼ãƒ³](#mvpãƒ‘ã‚¿ãƒ¼ãƒ³)
4. [ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
5. [ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
6. [ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é¢¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é¢¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
7. [ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³](#ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³)

## ğŸ¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### VB6ã«ãŠã‘ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ¶ç´„ã¨å¯¾ç­–

```vb
' VB6ã®åˆ¶ç´„
' - çœŸã®ç¶™æ‰¿ãŒãªã„ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç¶™æ‰¿ã®ã¿ï¼‰
' - ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ãŒãªã„
' - ãƒã‚¤ãƒ†ã‚£ãƒ–ãªãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚µãƒãƒ¼ãƒˆãŒãªã„
' - é™å®šçš„ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒãƒ¼ãƒˆ

' å¯¾ç­–
' - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆ
' - ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ´»ç”¨
' - COMã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«ã®ç†è§£ã¨æ´»ç”¨
' - ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
```

## ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 5å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿè£…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆFormsï¼‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆControllersï¼‰   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼ˆServicesï¼‰     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆDAOï¼‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ï¼ˆUtilitiesï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±¤ã®å®Ÿè£…ä¾‹

#### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
```vb
' ILogger.cls - ãƒ­ã‚®ãƒ³ã‚°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Sub LogInfo(Message As String)
End Sub

Public Sub LogError(Source As String, ErrorNumber As Long, Description As String)
End Sub

Public Sub LogDebug(Message As String)
End Sub

' FileLogger.cls - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ã‚¬ãƒ¼å®Ÿè£…
Option Explicit
Implements ILogger

Private m_LogPath As String

Private Sub Class_Initialize()
    m_LogPath = App.Path & "\Logs\"
    CreateLogDirectory
End Sub

Private Sub ILogger_LogInfo(Message As String)
    WriteLog "INFO", Message
End Sub

Private Sub ILogger_LogError(Source As String, ErrorNumber As Long, Description As String)
    WriteLog "ERROR", Source & " - " & ErrorNumber & ": " & Description
End Sub

Private Sub WriteLog(Level As String, Message As String)
    Dim fso As FileSystemObject
    Dim ts As TextStream
    Dim fileName As String
    
    Set fso = New FileSystemObject
    fileName = m_LogPath & Format(Date, "yyyymmdd") & ".log"
    
    Set ts = fso.OpenTextFile(fileName, ForAppending, True)
    ts.WriteLine Format(Now, "yyyy-mm-dd hh:nn:ss") & " [" & Level & "] " & Message
    ts.Close
    
    Set ts = Nothing
    Set fso = Nothing
End Sub
```

#### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
```vb
' IRepository.cls - ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Function GetAll() As Collection
End Function

Public Function GetByID(ID As Long) As Object
End Function

Public Function Save(Entity As Object) As Boolean
End Function

Public Function Delete(ID As Long) As Boolean
End Function

' CustomerRepository.cls - é¡§å®¢ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
Option Explicit
Implements IRepository

Private m_Connection As ADODB.Connection
Private m_Logger As ILogger

Private Sub Class_Initialize()
    Set m_Connection = DatabaseManager.GetConnection()
    Set m_Logger = LoggerFactory.GetLogger()
End Sub

Private Function IRepository_GetAll() As Collection
    Dim col As Collection
    Dim rs As ADODB.Recordset
    Dim customer As Customer
    
    On Error GoTo ErrorHandler
    
    Set col = New Collection
    Set rs = m_Connection.Execute("SELECT * FROM Customers ORDER BY Name")
    
    Do While Not rs.EOF
        Set customer = MapToCustomer(rs)
        col.Add customer, CStr(customer.ID)
        rs.MoveNext
    Loop
    
    rs.Close
    Set rs = Nothing
    
    Set IRepository_GetAll = col
    Exit Function
    
ErrorHandler:
    m_Logger.LogError "CustomerRepository.GetAll", Err.Number, Err.Description
    Set IRepository_GetAll = New Collection
End Function

Private Function MapToCustomer(rs As ADODB.Recordset) As Customer
    Dim customer As Customer
    Set customer = New Customer
    
    With customer
        .ID = rs("CustomerID")
        .Name = rs("CustomerName") & ""
        .Email = rs("Email") & ""
        .Phone = rs("Phone") & ""
        .Address = rs("Address") & ""
        .City = rs("City") & ""
        .PostalCode = rs("PostalCode") & ""
        .Country = rs("Country") & ""
        .IsActive = rs("IsActive")
        .CreatedDate = rs("CreatedDate")
    End With
    
    Set MapToCustomer = customer
End Function
```

#### ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
```vb
' ICustomerService.cls - é¡§å®¢ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Function GetActiveCustomers() As Collection
End Function

Public Function CreateCustomer(customerData As CustomerDTO) As Boolean
End Function

Public Function UpdateCustomerStatus(CustomerID As Long, IsActive As Boolean) As Boolean
End Function

Public Function ValidateCustomer(customer As Customer) As ValidationResult
End Function

' CustomerService.cls - é¡§å®¢ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
Option Explicit
Implements ICustomerService

Private m_Repository As IRepository
Private m_Logger As ILogger
Private m_Validator As IValidator

Private Sub Class_Initialize()
    Set m_Repository = RepositoryFactory.GetRepository("Customer")
    Set m_Logger = LoggerFactory.GetLogger()
    Set m_Validator = New CustomerValidator
End Sub

Private Function ICustomerService_GetActiveCustomers() As Collection
    Dim allCustomers As Collection
    Dim activeCustomers As Collection
    Dim customer As Customer
    
    Set activeCustomers = New Collection
    Set allCustomers = m_Repository.GetAll()
    
    ' ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼šã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªé¡§å®¢ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    For Each customer In allCustomers
        If customer.IsActive Then
            activeCustomers.Add customer
        End If
    Next
    
    m_Logger.LogInfo "Retrieved " & activeCustomers.Count & " active customers"
    Set ICustomerService_GetActiveCustomers = activeCustomers
End Function

Private Function ICustomerService_CreateCustomer(customerData As CustomerDTO) As Boolean
    Dim customer As Customer
    Dim validationResult As ValidationResult
    
    On Error GoTo ErrorHandler
    
    ' DTOã‹ã‚‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¸ã®å¤‰æ›
    Set customer = MapDTOToCustomer(customerData)
    
    ' ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®æ¤œè¨¼
    Set validationResult = m_Validator.Validate(customer)
    If Not validationResult.IsValid Then
        Err.Raise vbObjectError + 1001, , validationResult.GetErrorMessage()
    End If
    
    ' è¿½åŠ ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    customer.CreatedDate = Now
    customer.IsActive = True
    
    ' ä¿å­˜
    ICustomerService_CreateCustomer = m_Repository.Save(customer)
    
    If ICustomerService_CreateCustomer Then
        m_Logger.LogInfo "Customer created: " & customer.Name
        ' ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        RaiseEvent CustomerCreated(customer)
    End If
    
    Exit Function
    
ErrorHandler:
    m_Logger.LogError "CustomerService.CreateCustomer", Err.Number, Err.Description
    ICustomerService_CreateCustomer = False
End Function
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
```vb
' CustomerController.cls - é¡§å®¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
Option Explicit

Private m_Service As ICustomerService
Private m_View As ICustomerView
Private m_Logger As ILogger

Public Sub Initialize(View As ICustomerView)
    Set m_View = View
    Set m_Service = ServiceFactory.GetService("Customer")
    Set m_Logger = LoggerFactory.GetLogger()
End Sub

Public Sub LoadCustomers()
    On Error GoTo ErrorHandler
    
    Dim customers As Collection
    Set customers = m_Service.GetActiveCustomers()
    
    m_View.DisplayCustomers customers
    m_View.SetStatus "é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ (" & customers.Count & "ä»¶)"
    
    Exit Sub
    
ErrorHandler:
    m_View.ShowError "é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " & Err.Description
    m_Logger.LogError "CustomerController.LoadCustomers", Err.Number, Err.Description
End Sub

Public Sub SaveCustomer()
    On Error GoTo ErrorHandler
    
    Dim customerData As CustomerDTO
    Set customerData = m_View.GetCustomerData()
    
    If m_Service.CreateCustomer(customerData) Then
        m_View.ShowMessage "é¡§å®¢ã‚’ç™»éŒ²ã—ã¾ã—ãŸ"
        LoadCustomers ' ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    Else
        m_View.ShowError "é¡§å®¢ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ"
    End If
    
    Exit Sub
    
ErrorHandler:
    m_View.ShowError Err.Description
End Sub
```

## ğŸ‘¥ MVPãƒ‘ã‚¿ãƒ¼ãƒ³

### MVPï¼ˆModel-View-Presenterï¼‰ã®å®Ÿè£…

```vb
' IView.cls - åŸºæœ¬ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Sub ShowMessage(Message As String)
End Sub

Public Sub ShowError(ErrorMessage As String)
End Sub

Public Sub SetEnabled(ControlName As String, Enabled As Boolean)
End Sub

' ICustomerView.cls - é¡§å®¢ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit
Implements IView

Public Function GetCustomerData() As CustomerDTO
End Function

Public Sub SetCustomerData(customer As Customer)
End Sub

Public Sub DisplayCustomers(customers As Collection)
End Sub

Public Sub ClearForm()
End Sub

' CustomerPresenter.cls - é¡§å®¢ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼
Option Explicit

Private WithEvents m_View As frmCustomer
Private m_Model As CustomerModel
Private m_CurrentCustomer As Customer

Public Sub Initialize(View As frmCustomer, Model As CustomerModel)
    Set m_View = View
    Set m_Model = Model
    
    ' åˆæœŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    RefreshView
End Sub

Private Sub m_View_SaveRequested()
    On Error GoTo ErrorHandler
    
    ' ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    Dim customerData As CustomerDTO
    Set customerData = m_View.GetCustomerData()
    
    ' ãƒ¢ãƒ‡ãƒ«ã§ä¿å­˜
    If m_Model.SaveCustomer(customerData) Then
        m_View.ShowMessage "ä¿å­˜ã—ã¾ã—ãŸ"
        RefreshView
    End If
    
    Exit Sub
    
ErrorHandler:
    m_View.ShowError Err.Description
End Sub

Private Sub m_View_DeleteRequested(CustomerID As Long)
    If MsgBox("å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ", vbYesNo + vbQuestion) = vbYes Then
        If m_Model.DeleteCustomer(CustomerID) Then
            m_View.ShowMessage "å‰Šé™¤ã—ã¾ã—ãŸ"
            RefreshView
        End If
    End If
End Sub

Private Sub RefreshView()
    Dim customers As Collection
    Set customers = m_Model.GetAllCustomers()
    m_View.DisplayCustomers customers
End Sub
```

## ğŸ”Œ ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### COMãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…

```vb
' IBusinessService.cls - ãƒ“ã‚¸ãƒã‚¹ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Function ExecuteOperation(OperationName As String, Parameters As Dictionary) As ServiceResult
End Function

' OrderService.cls - æ³¨æ–‡ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆCOM+ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
Option Explicit
Implements IBusinessService

Private Function IBusinessService_ExecuteOperation(OperationName As String, Parameters As Dictionary) As ServiceResult
    Dim result As ServiceResult
    Set result = New ServiceResult
    
    Select Case OperationName
        Case "CreateOrder"
            Set result = CreateOrder(Parameters)
        Case "UpdateOrderStatus"
            Set result = UpdateOrderStatus(Parameters)
        Case "CalculateOrderTotal"
            Set result = CalculateOrderTotal(Parameters)
        Case Else
            result.Success = False
            result.ErrorMessage = "Unknown operation: " & OperationName
    End Select
    
    Set IBusinessService_ExecuteOperation = result
End Function

Private Function CreateOrder(Parameters As Dictionary) As ServiceResult
    Dim result As ServiceResult
    Dim tran As Transaction
    
    Set result = New ServiceResult
    
    On Error GoTo ErrorHandler
    
    ' COM+ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
    Set tran = GetObjectContext.CreateInstance("Transaction.Manager")
    tran.Begin
    
    ' æ³¨æ–‡ä½œæˆãƒ­ã‚¸ãƒƒã‚¯
    Dim orderID As Long
    orderID = CreateOrderRecord(Parameters)
    
    ' åœ¨åº«ç¢ºèªã¨æ›´æ–°
    If Not UpdateInventory(Parameters("Items")) Then
        Err.Raise vbObjectError + 2001, , "åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™"
    End If
    
    ' æ³¨æ–‡æ˜ç´°ä½œæˆ
    CreateOrderDetails orderID, Parameters("Items")
    
    ' ã‚³ãƒŸãƒƒãƒˆ
    tran.Commit
    
    result.Success = True
    result.Data = orderID
    
    Exit Function
    
ErrorHandler:
    tran.Rollback
    result.Success = False
    result.ErrorMessage = Err.Description
    
    Set CreateOrder = result
End Function
```

### ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®å®Ÿè£…

```vb
' ServiceFacade.cls - ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰
Option Explicit

Private m_Services As Dictionary

Private Sub Class_Initialize()
    Set m_Services = New Dictionary
    RegisterServices
End Sub

Private Sub RegisterServices()
    ' ã‚µãƒ¼ãƒ“ã‚¹ã®ç™»éŒ²
    m_Services.Add "Customer", "CustomerService.Manager"
    m_Services.Add "Order", "OrderService.Manager"
    m_Services.Add "Inventory", "InventoryService.Manager"
    m_Services.Add "Shipping", "ShippingService.Manager"
End Sub

Public Function CallService(ServiceName As String, OperationName As String, Parameters As Dictionary) As ServiceResult
    Dim service As IBusinessService
    Dim result As ServiceResult
    
    On Error GoTo ErrorHandler
    
    ' ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
    If m_Services.Exists(ServiceName) Then
        Set service = CreateObject(m_Services(ServiceName))
    Else
        Err.Raise vbObjectError + 3001, , "Service not found: " & ServiceName
    End If
    
    ' ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—
    Set result = service.ExecuteOperation(OperationName, Parameters)
    
    ' ãƒ­ã‚°è¨˜éŒ²
    LogServiceCall ServiceName, OperationName, result.Success
    
    Set CallService = result
    Exit Function
    
ErrorHandler:
    Set result = New ServiceResult
    result.Success = False
    result.ErrorMessage = Err.Description
    Set CallService = result
End Function
```

## ğŸ“¡ ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ã®å®Ÿè£…

```vb
' IEventHandler.cls - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Sub HandleEvent(EventData As Dictionary)
End Sub

' EventBus.cls - ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹å®Ÿè£…
Option Explicit

Private m_Handlers As Dictionary
Private m_AsyncQueue As Collection

Private Sub Class_Initialize()
    Set m_Handlers = New Dictionary
    Set m_AsyncQueue = New Collection
End Sub

Public Sub Subscribe(EventName As String, Handler As IEventHandler)
    Dim handlers As Collection
    
    If m_Handlers.Exists(EventName) Then
        Set handlers = m_Handlers(EventName)
    Else
        Set handlers = New Collection
        m_Handlers.Add EventName, handlers
    End If
    
    handlers.Add Handler
End Sub

Public Sub Publish(EventName As String, EventData As Dictionary)
    If Not m_Handlers.Exists(EventName) Then Exit Sub
    
    Dim handlers As Collection
    Dim handler As IEventHandler
    
    Set handlers = m_Handlers(EventName)
    
    ' åŒæœŸçš„ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
    For Each handler In handlers
        On Error Resume Next
        handler.HandleEvent EventData
        On Error GoTo 0
    Next
End Sub

Public Sub PublishAsync(EventName As String, EventData As Dictionary)
    ' éåŒæœŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
    Dim eventItem As Dictionary
    Set eventItem = New Dictionary
    
    eventItem.Add "EventName", EventName
    eventItem.Add "EventData", EventData
    eventItem.Add "Timestamp", Now
    
    m_AsyncQueue.Add eventItem
    
    ' ã‚¿ã‚¤ãƒãƒ¼ã§å‡¦ç†ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
    ProcessAsyncEvents
End Sub

Private Sub ProcessAsyncEvents()
    ' Windows ã‚¿ã‚¤ãƒãƒ¼APIã‚’ä½¿ç”¨ã—ãŸéåŒæœŸå‡¦ç†
    ' ã¾ãŸã¯ã€åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã®å‡¦ç†ï¼ˆCOM+ä½¿ç”¨ï¼‰
End Sub
```

### ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®å®Ÿè£…

```vb
' DomainEvent.cls - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹
Option Explicit

Public EventID As String
Public EventType As String
Public OccurredAt As Date
Public AggregateID As String
Public UserID As String
Public Data As Dictionary

Private Sub Class_Initialize()
    EventID = CreateGUID()
    OccurredAt = Now
    Set Data = New Dictionary
End Sub

' CustomerCreatedEvent.cls - é¡§å®¢ä½œæˆã‚¤ãƒ™ãƒ³ãƒˆ
Option Explicit

Private m_BaseEvent As DomainEvent

Private Sub Class_Initialize()
    Set m_BaseEvent = New DomainEvent
    m_BaseEvent.EventType = "CustomerCreated"
End Sub

Public Property Get CustomerID() As Long
    CustomerID = m_BaseEvent.Data("CustomerID")
End Property

Public Property Let CustomerID(Value As Long)
    m_BaseEvent.Data("CustomerID") = Value
End Property

Public Property Get CustomerName() As String
    CustomerName = m_BaseEvent.Data("CustomerName")
End Property

Public Property Let CustomerName(Value As String)
    m_BaseEvent.Data("CustomerName") = Value
End Property
```

## ğŸ¯ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é¢¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### COMã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹åˆ†é›¢

```vb
' ServiceRegistry.cls - ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
Option Explicit

Private m_Services As Dictionary
Private m_ServiceEndpoints As Dictionary

Private Sub Class_Initialize()
    Set m_Services = New Dictionary
    Set m_ServiceEndpoints = New Dictionary
    LoadServiceConfiguration
End Sub

Private Sub LoadServiceConfiguration()
    ' ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã®èª­ã¿è¾¼ã¿ï¼ˆINIãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ï¼‰
    m_ServiceEndpoints.Add "CustomerService", "http://localhost:8081/customer"
    m_ServiceEndpoints.Add "OrderService", "http://localhost:8082/order"
    m_ServiceEndpoints.Add "InventoryService", "http://localhost:8083/inventory"
    
    ' COMã‚µãƒ¼ãƒ“ã‚¹ã®ç™»éŒ²
    m_Services.Add "CustomerService", "Customer.Service"
    m_Services.Add "OrderService", "Order.Service"
    m_Services.Add "InventoryService", "Inventory.Service"
End Sub

Public Function GetService(ServiceName As String) As Object
    If m_Services.Exists(ServiceName) Then
        ' ãƒ­ãƒ¼ã‚«ãƒ«COMã‚µãƒ¼ãƒ“ã‚¹
        Set GetService = CreateObject(m_Services(ServiceName))
    Else
        ' ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ã‚­ã‚·
        Dim proxy As ServiceProxy
        Set proxy = New ServiceProxy
        proxy.Initialize ServiceName, m_ServiceEndpoints(ServiceName)
        Set GetService = proxy
    End If
End Function
```

### ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡

```vb
' ServiceProxy.cls - ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ã‚­ã‚·
Option Explicit

Private m_ServiceName As String
Private m_Endpoint As String
Private m_HttpClient As WinHttp.WinHttpRequest

Public Sub Initialize(ServiceName As String, Endpoint As String)
    m_ServiceName = ServiceName
    m_Endpoint = Endpoint
    Set m_HttpClient = New WinHttp.WinHttpRequest
End Sub

Public Function CallMethod(MethodName As String, Parameters As Dictionary) As Dictionary
    Dim url As String
    Dim jsonRequest As String
    Dim jsonResponse As String
    
    On Error GoTo ErrorHandler
    
    ' URLã®æ§‹ç¯‰
    url = m_Endpoint & "/" & MethodName
    
    ' JSONãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
    jsonRequest = DictionaryToJSON(Parameters)
    
    ' HTTP POST
    With m_HttpClient
        .Open "POST", url, False
        .SetRequestHeader "Content-Type", "application/json"
        .Send jsonRequest
        
        If .Status = 200 Then
            jsonResponse = .ResponseText
            Set CallMethod = JSONToDictionary(jsonResponse)
        Else
            Err.Raise vbObjectError + 4001, , "Service call failed: " & .StatusText
        End If
    End With
    
    Exit Function
    
ErrorHandler:
    Dim errorResult As Dictionary
    Set errorResult = New Dictionary
    errorResult.Add "Success", False
    errorResult.Add "Error", Err.Description
    Set CallMethod = errorResult
End Function
```

## ğŸ”— ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

```vb
' IMessageQueue.cls - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Option Explicit

Public Sub SendMessage(QueueName As String, Message As String)
End Sub

Public Function ReceiveMessage(QueueName As String, TimeoutSeconds As Long) As String
End Function

' MSMQAdapter.cls - Microsoft Message Queue ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
Option Explicit
Implements IMessageQueue

Private Sub IMessageQueue_SendMessage(QueueName As String, Message As String)
    Dim qInfo As MSMQ.MSMQQueueInfo
    Dim q As MSMQ.MSMQQueue
    Dim msg As MSMQ.MSMQMessage
    
    Set qInfo = New MSMQ.MSMQQueueInfo
    qInfo.PathName = ".\Private$\" & QueueName
    
    Set q = qInfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
    
    Set msg = New MSMQ.MSMQMessage
    msg.Label = "VB6 Message"
    msg.Body = Message
    msg.Send q
    
    q.Close
End Sub

Private Function IMessageQueue_ReceiveMessage(QueueName As String, TimeoutSeconds As Long) As String
    Dim qInfo As MSMQ.MSMQQueueInfo
    Dim q As MSMQ.MSMQQueue
    Dim msg As MSMQ.MSMQMessage
    
    Set qInfo = New MSMQ.MSMQQueueInfo
    qInfo.PathName = ".\Private$\" & QueueName
    
    Set q = qInfo.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
    
    Set msg = q.Receive(, , , TimeoutSeconds * 1000)
    
    If Not msg Is Nothing Then
        IMessageQueue_ReceiveMessage = msg.Body
    Else
        IMessageQueue_ReceiveMessage = ""
    End If
    
    q.Close
End Function
```

### ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

```vb
' CircuitBreaker.cls - ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼å®Ÿè£…
Option Explicit

Private Enum CircuitState
    Closed = 0
    Open = 1
    HalfOpen = 2
End Enum

Private m_State As CircuitState
Private m_FailureCount As Long
Private m_LastFailureTime As Date
Private m_Threshold As Long
Private m_Timeout As Long

Private Sub Class_Initialize()
    m_State = Closed
    m_FailureCount = 0
    m_Threshold = 5
    m_Timeout = 60 ' ç§’
End Sub

Public Function Call(Target As Object, MethodName As String, Parameters As Variant) As Variant
    On Error GoTo ErrorHandler
    
    ' ã‚µãƒ¼ã‚­ãƒƒãƒˆãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
    If m_State = Open Then
        If DateDiff("s", m_LastFailureTime, Now) > m_Timeout Then
            m_State = HalfOpen
        Else
            Err.Raise vbObjectError + 5001, , "Circuit breaker is open"
        End If
    End If
    
    ' ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—
    Call = CallByName(Target, MethodName, VbMethod, Parameters)
    
    ' æˆåŠŸæ™‚ã®å‡¦ç†
    If m_State = HalfOpen Then
        m_State = Closed
        m_FailureCount = 0
    End If
    
    Exit Function
    
ErrorHandler:
    m_FailureCount = m_FailureCount + 1
    m_LastFailureTime = Now
    
    If m_FailureCount >= m_Threshold Then
        m_State = Open
    End If
    
    Err.Raise Err.Number, Err.Source, Err.Description
End Function
```

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€VB6ã§ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªå‚è€ƒè³‡æ–™ã§ã™ã€‚