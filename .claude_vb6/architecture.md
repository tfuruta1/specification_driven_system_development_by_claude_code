# VB6 ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

VB6ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®åŒ…æ‹¬çš„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚ãƒ¬ã‚¬ã‚·ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ä¿å®ˆæ€§ã‚’é‡è¦–ã—ãŸè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. 3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (æ¨å¥¨)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤                    â”‚
â”‚  â”œâ”€ ãƒ•ã‚©ãƒ¼ãƒ  (.frm)                                   â”‚
â”‚  â”œâ”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« (.ctl)                        â”‚
â”‚  â””â”€ ActiveXã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« (.ocx)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤                    â”‚
â”‚  â”œâ”€ ãƒ“ã‚¸ãƒã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (.cls)                        â”‚
â”‚  â”œâ”€ ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«                                    â”‚
â”‚  â””â”€ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤                      â”‚
â”‚  â”œâ”€ DAOãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…                                   â”‚
â”‚  â”œâ”€ ADO/DAO/RDOæ¥ç¶šç®¡ç†                              â”‚
â”‚  â””â”€ ã‚¹ãƒˆã‚¢ãƒ‰ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£å‘¼ã³å‡ºã—                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. MVP (Model-View-Presenter) ãƒ‘ã‚¿ãƒ¼ãƒ³

```vb
' IView ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Public Interface ICustomerView
    Property CustomerName As String
    Property CustomerID As Long
    Sub ShowMessage(ByVal message As String)
    Sub ShowCustomerList(ByVal customers As Collection)
End Interface

' Presenter ã‚¯ãƒ©ã‚¹
Public Class CustomerPresenter
    Private m_View As ICustomerView
    Private m_Model As CustomerModel
    
    Public Sub New(ByVal view As ICustomerView)
        Set m_View = view
        Set m_Model = New CustomerModel
    End Sub
    
    Public Sub LoadCustomer(ByVal customerID As Long)
        On Error GoTo ErrorHandler
        
        Dim customer As Customer
        Set customer = m_Model.GetCustomer(customerID)
        
        m_View.CustomerName = customer.Name
        m_View.CustomerID = customer.ID
        
        Exit Sub
ErrorHandler:
        m_View.ShowMessage "ã‚¨ãƒ©ãƒ¼: " & Err.Description
    End Sub
End Class
```

### 3. ã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (SOA)

```vb
' ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
Public Interface IOrderService
    Function CreateOrder(ByVal orderData As OrderDTO) As Long
    Function GetOrder(ByVal orderID As Long) As OrderDTO
    Function UpdateOrder(ByVal orderData As OrderDTO) As Boolean
    Function DeleteOrder(ByVal orderID As Long) As Boolean
End Interface

' ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
Public Class OrderService
    Implements IOrderService
    
    Private m_OrderDAO As OrderDAO
    Private m_Logger As ILogger
    
    Private Function IOrderService_CreateOrder(ByVal orderData As OrderDTO) As Long
        On Error GoTo ErrorHandler
        
        ' ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
        BeginTransaction
        
        ' ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
        ValidateOrder orderData
        
        ' ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
        Dim orderID As Long
        orderID = m_OrderDAO.Insert(orderData)
        
        ' ç›£æŸ»ãƒ­ã‚°
        m_Logger.LogInfo "Order created: " & orderID
        
        ' ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒŸãƒƒãƒˆ
        CommitTransaction
        
        IOrderService_CreateOrder = orderID
        Exit Function
        
ErrorHandler:
        RollbackTransaction
        m_Logger.LogError "CreateOrder failed: " & Err.Description
        Err.Raise Err.Number, Err.Source, Err.Description
    End Function
End Class
```

## ğŸ”§ è¨­è¨ˆåŸå‰‡

### SOLIDåŸå‰‡ã®é©ç”¨

#### 1. å˜ä¸€è²¬ä»»ã®åŸå‰‡ (SRP)
```vb
' æ‚ªã„ä¾‹ - è¤‡æ•°ã®è²¬ä»»
Public Class Customer
    Public Sub Save()
        ' ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯
    End Sub
    
    Public Sub SendEmail()
        ' ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
    End Sub
    
    Public Sub CalculateDiscount()
        ' å‰²å¼•è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
    End Sub
End Class

' è‰¯ã„ä¾‹ - è²¬ä»»ã®åˆ†é›¢
Public Class Customer
    ' é¡§å®¢ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã¿
End Class

Public Class CustomerRepository
    Public Sub Save(ByVal customer As Customer)
        ' ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯
    End Sub
End Class

Public Class EmailService
    Public Sub SendCustomerEmail(ByVal customer As Customer)
        ' ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
    End Sub
End Class

Public Class DiscountCalculator
    Public Function Calculate(ByVal customer As Customer) As Double
        ' å‰²å¼•è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
    End Function
End Class
```

#### 2. é–‹æ”¾é–‰é–ã®åŸå‰‡ (OCP)
```vb
' æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆ
Public Interface IPaymentProcessor
    Function ProcessPayment(ByVal amount As Currency) As Boolean
End Interface

Public Class CreditCardProcessor
    Implements IPaymentProcessor
    
    Private Function IPaymentProcessor_ProcessPayment(ByVal amount As Currency) As Boolean
        ' ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰å‡¦ç†
    End Function
End Class

Public Class PayPalProcessor
    Implements IPaymentProcessor
    
    Private Function IPaymentProcessor_ProcessPayment(ByVal amount As Currency) As Boolean
        ' PayPalå‡¦ç†
    End Function
End Class
```

## ğŸ›ï¸ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. Repository ãƒ‘ã‚¿ãƒ¼ãƒ³
```vb
Public Interface IRepository(Of T)
    Function GetById(ByVal id As Long) As T
    Function GetAll() As Collection
    Function Add(ByVal entity As T) As Long
    Function Update(ByVal entity As T) As Boolean
    Function Delete(ByVal id As Long) As Boolean
End Interface

Public Class CustomerRepository
    Implements IRepository(Of Customer)
    
    Private m_Connection As ADODB.Connection
    
    Public Function GetById(ByVal id As Long) As Customer
        Dim sql As String
        sql = "SELECT * FROM Customers WHERE CustomerID = ?"
        
        Dim cmd As New ADODB.Command
        Set cmd.ActiveConnection = m_Connection
        cmd.CommandText = sql
        cmd.Parameters.Append cmd.CreateParameter("id", adInteger, adParamInput, , id)
        
        Dim rs As ADODB.Recordset
        Set rs = cmd.Execute
        
        If Not rs.EOF Then
            Set GetById = MapToCustomer(rs)
        End If
        
        rs.Close
    End Function
End Class
```

### 2. Unit of Work ãƒ‘ã‚¿ãƒ¼ãƒ³
```vb
Public Class UnitOfWork
    Private m_Connection As ADODB.Connection
    Private m_Transaction As Boolean
    Private m_Repositories As Collection
    
    Public Sub BeginTransaction()
        m_Connection.BeginTrans
        m_Transaction = True
    End Sub
    
    Public Sub Commit()
        If m_Transaction Then
            m_Connection.CommitTrans
            m_Transaction = False
        End If
    End Sub
    
    Public Sub Rollback()
        If m_Transaction Then
            m_Connection.RollbackTrans
            m_Transaction = False
        End If
    End Sub
    
    Public Property Get CustomerRepository() As CustomerRepository
        ' é…å»¶åˆæœŸåŒ–
        If m_CustomerRepository Is Nothing Then
            Set m_CustomerRepository = New CustomerRepository
            Set m_CustomerRepository.Connection = m_Connection
        End If
        Set CustomerRepository = m_CustomerRepository
    End Property
End Class
```

### 3. Factory ãƒ‘ã‚¿ãƒ¼ãƒ³
```vb
Public Class DocumentFactory
    Public Function CreateDocument(ByVal docType As DocumentType) As IDocument
        Select Case docType
            Case dtInvoice
                Set CreateDocument = New InvoiceDocument
            Case dtPurchaseOrder
                Set CreateDocument = New PurchaseOrderDocument
            Case dtQuotation
                Set CreateDocument = New QuotationDocument
            Case Else
                Err.Raise vbObjectError + 1000, "DocumentFactory", "Unknown document type"
        End Select
    End Function
End Class
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### èªè¨¼ãƒ»èªå¯
```vb
Public Class SecurityManager
    Private m_CurrentUser As User
    
    Public Function Authenticate(ByVal username As String, ByVal password As String) As Boolean
        On Error GoTo ErrorHandler
        
        ' ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
        Dim hashedPassword As String
        hashedPassword = HashPassword(password)
        
        ' ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç…§åˆ
        Dim user As User
        Set user = m_UserRepository.GetByCredentials(username, hashedPassword)
        
        If Not user Is Nothing Then
            Set m_CurrentUser = user
            
            ' ç›£æŸ»ãƒ­ã‚°
            LogSecurityEvent "LOGIN_SUCCESS", username
            
            Authenticate = True
        Else
            LogSecurityEvent "LOGIN_FAILED", username
            Authenticate = False
        End If
        
        Exit Function
ErrorHandler:
        LogSecurityEvent "LOGIN_ERROR", username & " - " & Err.Description
        Authenticate = False
    End Function
    
    Public Function HasPermission(ByVal resource As String, ByVal action As String) As Boolean
        If m_CurrentUser Is Nothing Then
            HasPermission = False
            Exit Function
        End If
        
        ' æ¨©é™ãƒã‚§ãƒƒã‚¯
        HasPermission = m_PermissionService.CheckPermission(m_CurrentUser, resource, action)
    End Function
End Class
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°
```vb
Public Class ConnectionPool
    Private m_Connections As Collection
    Private m_MaxConnections As Integer
    
    Public Function GetConnection() As ADODB.Connection
        Dim conn As ADODB.Connection
        
        ' åˆ©ç”¨å¯èƒ½ãªæ¥ç¶šã‚’æ¢ã™
        For Each conn In m_Connections
            If conn.State = adStateClosed Then
                conn.Open
                Set GetConnection = conn
                Exit Function
            End If
        Next
        
        ' æ–°è¦æ¥ç¶šä½œæˆ
        If m_Connections.Count < m_MaxConnections Then
            Set conn = CreateNewConnection()
            m_Connections.Add conn
            Set GetConnection = conn
        Else
            Err.Raise vbObjectError + 2000, "ConnectionPool", "Maximum connections reached"
        End If
    End Function
    
    Public Sub ReturnConnection(ByVal conn As ADODB.Connection)
        ' æ¥ç¶šã‚’ãƒ—ãƒ¼ãƒ«ã«è¿”ã™ï¼ˆé–‰ã˜ãªã„ï¼‰
        conn.Close
    End Sub
End Class
```

### 2. é…å»¶èª­ã¿è¾¼ã¿
```vb
Public Class Order
    Private m_OrderID As Long
    Private m_OrderDetails As Collection
    Private m_DetailsLoaded As Boolean
    
    Public Property Get OrderDetails() As Collection
        ' å¿…è¦æ™‚ã®ã¿è©³ç´°ã‚’èª­ã¿è¾¼ã‚€
        If Not m_DetailsLoaded Then
            LoadOrderDetails
            m_DetailsLoaded = True
        End If
        Set OrderDetails = m_OrderDetails
    End Property
    
    Private Sub LoadOrderDetails()
        Set m_OrderDetails = m_OrderDetailRepository.GetByOrderID(m_OrderID)
    End Sub
End Class
```

## ğŸ”„ éåŒæœŸå‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³
```vb
Public Interface IAsyncCallback
    Sub OnComplete(ByVal result As Variant)
    Sub OnError(ByVal errorInfo As String)
End Interface

Public Class AsyncDataLoader
    Public Sub LoadDataAsync(ByVal query As String, ByVal callback As IAsyncCallback)
        ' ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ãŸéåŒæœŸå®Ÿè¡Œ
        Dim asyncTimer As Timer
        Set asyncTimer = New Timer
        
        With asyncTimer
            .Interval = 1
            .Tag = query & "|" & ObjPtr(callback)
            .Enabled = True
        End With
    End Sub
    
    Private Sub Timer_Timer()
        On Error GoTo ErrorHandler
        
        ' éåŒæœŸå‡¦ç†å®Ÿè¡Œ
        Dim result As ADODB.Recordset
        Set result = ExecuteQuery(ParseQuery(Timer.Tag))
        
        ' ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‘¼ã³å‡ºã—
        Dim callback As IAsyncCallback
        Set callback = GetCallbackFromTag(Timer.Tag)
        callback.OnComplete result
        
        Timer.Enabled = False
        Exit Sub
        
ErrorHandler:
        callback.OnError Err.Description
        Timer.Enabled = False
    End Sub
End Class
```

## ğŸ“‹ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### è¨­è¨ˆæ™‚
- [ ] ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ãŒæ˜ç¢ºã‹
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆã‹
- [ ] ä¾å­˜é–¢ä¿‚ãŒé©åˆ‡ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•ŒãŒæ˜ç¢ºã‹

### å®Ÿè£…æ™‚
- [ ] å‘½åè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆãŒé©åˆ‡ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ãŒé©åˆ‡ã‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹ã‹

### ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚
- [ ] SOLIDåŸå‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹
- [ ] ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ãŒé«˜ã„ã‹
- [ ] ä¿å®ˆæ€§ãŒé«˜ã„ã‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹ã‹

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. `/vb6-analyze-code` - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®åˆ†æ
2. `/vb6-refactor-to-patterns` - ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
3. `/vb6-create-project` - æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
4. `/vb6-migration-assessment` - ç§»è¡Œè©•ä¾¡

---

è©³ç´°ãªå®Ÿè£…ä¾‹ã¯ã€å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚